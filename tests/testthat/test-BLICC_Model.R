# options(digits=20)

test_that("Selectivity function", {
  expect_equal(
    sum(abs(Rsel_dsnormal(LMP=seq(15.5, 25.5, by=1.0), 30, 0.1, 0.2)-
              c(7.3953463438962621576e-10,1.2161385837529812455e-08,
                1.6373771305908126076e-07,1.8049096912131340013e-06,
                1.6289334328458021265e-05,1.2036280516721315967e-04,
                7.2815253908946038584e-04,3.6065631360157304926e-03,
                1.4625334709594208296e-02,4.8557821270009945969e-02,
                1.3199384318783022318e-01))),
    0, tolerance=1.0e-8)
})

glq <- statmod::gauss.quad(90, kind = "laguerre", alpha = 0.0)

test_that("Survival function", {
  expect_equal(
    sum(abs(RSurvival_Est(glq$nodes, glq$weights, Len=15:25, Zki=c(rep(1.5, 5),
                                        rep(3, 6)), 100, 100/50) -
      c(0.99999999999999367173,0.95656595969031632531,0.91379447731316587600,
        0.87169624596866146504,0.83028250925183433306,0.78956511178378785409,
        0.71163574342454660737,0.63917106786559274578,0.57196552056022786914,
        0.50981353696191411551,0.45250955252483798796))),
    0, tolerance=1.0e-8)
})

test_that("Numbers in Interval", {
  expect_equal(
    sum(abs(RNinInterval(exp(-seq(0.2, 1.2, by=0.1)) , seq(0.2, 1.2, by=0.1)) -
      c(0.389562661981319724447,0.234993915486928467429,
        0.159473465807514758197,0.115438047237214069796,
        0.087043887171028094807,0.067509056677411374836,
        0.053449130470778136170,0.042989131743507463801,
        0.035008357473362783363,0.028797156168979466673,
        0.250995176593501789775))),
    0, tolerance=1.0e-8)
})

test_that("Mature biomass at length", {
  expect_equal(
    sum(abs(mature_biomass_at_length(list(LMP=seq(25.5, 35.5, by=1),
                                          a=1.0e-4, b=3.1, Lm=32, Ls=1.0)) -
              c(0.0034411846894150987033,0.0105116601974066421754,
                0.0318279163283370150617,0.0948566836418767711514,
                0.2731811119843376989280,0.7284757578097222907587,
                1.6661974196629616429277,3.0265607861521988120046,
                4.3668294104675728917186,5.4072670466835051072962,
                6.2056524912137378535704))),
    0, tolerance=1.0e-8)
})


test_that("Weight at length", {
  expect_equal(
    sum(abs(weight_at_length(list(LMP=seq(25.5, 35.5, by=1),
                                          a=1.0e-4, b=3.1)) -
              c(2.2923163886142288170,2.5826301052057343277,
                2.8968856394782722674,3.2360786337453220085,
                3.6012083589117911409,3.9932775995917935141,
                4.4132925466469545839,4.8622626964374786596,
                5.3412007561660761468,5.8511225547695735472,
                6.3930469588765852507))),
    0, tolerance=1.0e-8)
})

